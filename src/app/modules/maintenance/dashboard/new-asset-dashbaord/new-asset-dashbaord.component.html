<app-breadcrumbs
  [title]="'Dashboard'"
  [breadcrumbItems]="breadCrumbItems"
></app-breadcrumbs>


<div class="d-flex justify-content-between">
  <div></div>
  <div class="search-box">
    <div class="input-group me-1">
      <ng-select
        [items]="companyList"
        class="ng-select-width"
        bindLabel="companyName"
        [clearable]="true"
        bindValue="companyId"
        placeholder="Select Company"
        [(ngModel)]="selectedCompanyId"
        (change)="onChangeCompanyDropdown()"
      ></ng-select>
    </div>
  </div>
</div>
<div class="row mt-4">
  <div class="col-lg" *ngFor="let stat of totalAssetCounts" (click)="onClickTopCard(stat.statuId)">
    <div class="card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span
              class="avatar-title bg-light text-primary rounded-circle fs-3"
            >
              <i class="{{ stat.icon }} align-middle"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-semibold fs-12 text-muted mb-1">
              {{ stat.title }}
            </p>
            <h4 class="mb-0">
              <span
                *ngIf="stat.value != 0"
                [countUp]="stat.value"
                class="counter-value cursor"
              
                [options]="option"
              ></span>
              <span *ngIf="stat.value == 0">0</span>
            </h4>
          </div>
        </div>
      </div>
      <!-- end card body -->
    </div>
    <!-- end card -->
  </div>
  <!-- end col -->
</div>
<div class="row align-items-center">
  <div class="col">
    <!-- Nav tabs -->
    <ul
      ngbNav
      #nav="ngbNav"
      [(activeId)]="maintabsActive"
      (activeIdChange)="onTabChangeMaintabsActive($event)"
      class="nav nav-tabs-custom card-header-tabs border-bottom-0"
    >
      <li [ngbNavItem]="1">
        <a ngbNavLink> My Task </a>
        <ng-template ngbNavContent>
          <div class="row">
            <div class="col-xl-7">
              <div class="card card-height-100">
                <ul
                  ngbNav
                  #todoWorkFlowTabs="ngbNav"
                  [activeId]="1"
                  class="nav nav-tabs nav-justified nav-border-top nav-border-top-primary mb-0"
                >
                  <li [ngbNavItem]="1" (click)="getV2_TotalCountTicketServiceOrderIncident()" >
                    <a ngbNavLink>
                      <i class="ri-todo-line align-middle me-1"></i>My Task
                    </a>
                    <ng-template ngbNavContent>
                      <div class="card-body my-tasks myTaskCardBody">
                        <h5 class="card-title mb-2">My Task</h5>

                        <ng-container
                          *ngIf="
                            checktheRuleOfClientDashbard.auditCompletionAcknowlegementAdmin
                          "
                        > <ng-container
                        *ngIf="
                          totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin!=0
                        "
                      >
                          <hr class="my-3" />
                          <!--   ScheduleCompletionAcknowlegementClient-->
                          <div class="row g-3 cursor">
                            <div class="col-auto">
                              <div
                                class="avatar-sm p-1 py-2 h-auto rounded-3"
                                [ngClass]="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin ==
                                  0
                                    ? 'bg-success-subtle'
                                    : 'bg-danger-subtle'
                                "
                              >
                                <div class="text-center">
                                  <h5 class="mb-0">
                                    <i
                                      class="bx bx-bell text-success mt-2"
                                      *ngIf="
                                        totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin ==
                                        0
                                      "
                                    ></i>
                                    <i
                                      class="bx bx-bell text-danger mt-2"
                                      *ngIf="
                                        totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin !=
                                        0
                                      "
                                    ></i>
                                  </h5>
                                </div>
                              </div>
                            </div>
                            <div
                              class="col align-items-center"
                              (click)="
                                myTaskAuditListForAdmin(
                                  61,
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin,

                                  'Audit Completion Acknowledgement  Admin'
                                )
                              "
                            >
                              <h5 class="text-muted mt-0 mb-1 fs-14">
                                Audit Completion Acknowledgement  Admin
                              </h5>
                              <a
                                href="javascript:void(0);"
                                *ngIf="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin ==
                                  0
                                "
                                class="text-reset fs-13 mb-0"
                                >No Transaction</a
                              >
                              <a
                                href="javascript:void(0);"
                                *ngIf="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin !=
                                  0
                                "
                                class="text-reset fs-13 mb-0"
                              >
                                The member has completed the task and is now
                                waiting for the incident report signature from
                                the Client.
                              </a>
                            </div>
                            <div class="col-sm-auto">
                              <div class="avatar-group">
                                <div class="avatar-group-item">
                                  <a href="javascript: void(0);">
                                    <div class="avatar-xs">
                                      <span
                                        class="avatar-title rounded-circle text-white"
                                        [ngClass]="
                                          !totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin
                                            ? 'bg-success'
                                            : 'bg-danger'
                                        "
                                      >
                                        {{
                                          totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin
                                        }}
                                      </span>
                                    </div>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!--   End ScheduleCompletionAcknowlegementClient-->
                          </ng-container>
                        </ng-container>

                        <ng-container
                          *ngIf="
                            checktheRuleOfClientDashbard.auditCompletionAcknowlegementClient
                          "
                        ><ng-container
                        *ngIf="
                          totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient!=0
                        "
                      >
                          <hr class="my-3" />
                          <!--   ScheduleCompletionAcknowlegementClient-->
                          <div class="row g-3 cursor">
                            <div class="col-auto">
                              <div
                                class="avatar-sm p-1 py-2 h-auto rounded-3"
                                [ngClass]="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient ==
                                  0
                                    ? 'bg-success-subtle'
                                    : 'bg-danger-subtle'
                                "
                              >
                                <div class="text-center">
                                  <h5 class="mb-0">
                                    <i
                                      class="bx bx-bell text-success mt-2"
                                      *ngIf="
                                        totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient ==
                                        0
                                      "
                                    ></i>
                                    <i
                                      class="bx bx-bell text-danger mt-2"
                                      *ngIf="
                                        totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient !=
                                        0
                                      "
                                    ></i>
                                  </h5>
                                </div>
                              </div>
                            </div>
                            <div
                              class="col align-items-center"
                              (click)="
                                myTaskAuditListForClient(
                                  62,
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient,

                                  'Audit Completion Acknowledgement  Client'
                                )
                              "
                            >
                              <h5 class="text-muted mt-0 mb-1 fs-14">
                                Audit Completion Acknowledgement  Client
                              </h5>
                              <a
                                href="javascript:void(0);"
                                *ngIf="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient ==
                                  0
                                "
                                class="text-reset fs-13 mb-0"
                                >No Transaction</a
                              >
                              <a
                                href="javascript:void(0);"
                                *ngIf="
                                  totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient !=
                                  0
                                "
                                class="text-reset fs-13 mb-0"
                              >
                                The member has completed the task and is now
                                waiting for the incident report signature from
                                the Client.
                              </a>
                            </div>
                            <div class="col-sm-auto">
                              <div class="avatar-group">
                                <div class="avatar-group-item">
                                  <a href="javascript: void(0);">
                                    <div class="avatar-xs">
                                      <span
                                        class="avatar-title rounded-circle text-white"
                                        [ngClass]="
                                          !totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient
                                            ? 'bg-success'
                                            : 'bg-danger'
                                        "
                                      >
                                        {{
                                          totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient
                                        }}
                                      </span>
                                    </div>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!--   End ScheduleCompletionAcknowlegementClient-->
                        </ng-container>
                        </ng-container>

                        <ng-container  *ngIf="
                        totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementAdmin==0  &&   totalCountTicketServiceOrderIncident.countTotalAuditCompletionAcknowlegementClient==0
                      ">
                    <p> No task assigned.</p>  
                    
                    </ng-container>
                      </div>
                    </ng-template>
                  </li>
                  <ng-container *ngIf="totalCountWorkflowTodoList.length != 0">
                    <li [ngbNavItem]="2" (click)="getV2_DashboardTodoList()">
                      <a ngbNavLink>
                        <i class="ri-stack-overflow-line align-middle me-1"></i
                        >WorkFlow
                        <span
                          class="badge bg-danger rounded-circle"
                          *ngIf="totalCountWorkflowTodoList.length != 0"
                          >{{ totalCountWorkflowTodoList.length }}</span
                        >
                      </a>
                      <ng-template ngbNavContent>
                        <div class="card-body my-tasks myTaskCardBody">
                          <h5 class="card-title mb-2">WorkFlow</h5>
                          <hr class="my-3" />
                          <ng-container
                            *ngFor="let workFlow of totalCountWorkflowTodoList"
                          >
                            <div class="row g-3 cursor">
                              <div class="col-auto">
                                <div
                                  class="avatar-sm p-1 py-2 h-auto rounded-3"
                                  [ngClass]="
                                    workFlow.assetCount == 0
                                      ? 'bg-success-subtle'
                                      : 'bg-danger-subtle'
                                  "
                                >
                                  <div class="text-center">
                                    <h5 class="mb-0">
                                      <i
                                        class="bx bx-bell text-success mt-2"
                                        *ngIf="workFlow.assetCount == 0"
                                      ></i>
                                      <i
                                        class="bx bx-bell text-danger mt-2"
                                        *ngIf="workFlow.assetCount != 0"
                                      ></i>
                                    </h5>
                                  </div>
                                </div>
                              </div>
                              <div
                                class="col align-items-center"
                                (click)="navigateMyWorkflowPageList(workFlow)"
                              >
                                <h5 class="text-muted mt-0 mb-1 fs-14">
                                  {{ workFlow.workflowName }}
                                </h5>

                                <a
                                  href="javascript:void(0);"
                                  class="text-reset fs-13 mb-0"
                                >
                                  Waiting For {{ workFlow.approverType }}
                                </a>
                              </div>

                              <div class="col-sm-auto">
                                <div class="avatar-group">
                                  <div class="avatar-group-item">
                                    <a href="javascript: void(0);">
                                      <div class="avatar-xs">
                                        <span
                                          class="avatar-title rounded-circle text-white"
                                          [ngClass]="
                                            !workFlow.assetCount
                                              ? 'bg-success'
                                              : 'bg-danger'
                                          "
                                        >
                                          {{ workFlow.assetCount }}
                                        </span>
                                      </div>
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <hr class="my-3" />
                          </ng-container>
                        </div>
                      </ng-template>
                    </li>
                  </ng-container>
                </ul>

                <div class="card-body">
                  <div class="tab-content text-muted">
                    <div [ngbNavOutlet]="todoWorkFlowTabs"></div>
                  </div>
                </div>
              </div>
              <!-- end card -->
            </div>
            <div class="col-xl-5">
              <div class="card card-height-100">
                <div class="card-header">
                  <h5 class="card-title mb-0">Projects By Ticket (Billing)</h5>
                </div>

                <div class="card-body">
                  <div *ngFor="let project of projectList">
                    <h6 class="text-muted">{{ project.projectName }}</h6>
                    <div class="d-flex flex-wrap justify-content-between">
                      <p class="text-muted mb-0">
                        <span class="badge bg-primary ms-1 borderEaduis">{{
                          project.isBillingRequired_1_Count
                        }}</span>

                        Billable
                      </p>

                      <p class="text-muted mb-0">
                        <span class="badge bg-success ms-1 borderEaduis">{{
                          project.isBillingRequired_0_Count
                        }}</span>

                        Non Billable
                      </p>

                      <p class="text-muted mb-0">
                        <span class="badge bg-primary ms-1 borderEaduis">{{
                          project.isBillingRequired_Null_Count
                        }}</span>
                        Waiting
                      </p>
                    </div>
                    <hr class="mb-1 mt-1" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="2">
        <a ngbNavLink> Graph </a>
        <ng-template ngbNavContent>
          <div class="row">
            <div
              class="col-sm-6 col-md-6 col-lg-6"
              *ngIf="expiredAssetsCounts && expiredAssetsCounts.series"
            >
              <div class="card card-height-100">
                <div class="card-header align-items-center d-flex">
                  <h4 class="card-title mb-0">Expired Asset Counts</h4>
                </div>

                <div class="card-body pt-5">
                  <apx-chart
                    class="apex-charts"
                    dir="ltr"
                    [series]="expiredAssetsCounts.series"
                    [labels]="expiredAssetsCounts.labels"
                    [chart]="expiredAssetsCounts.chart"
                    [plotOptions]="expiredAssetsCounts.plotOptions"
                    [dataLabels]="expiredAssetsCounts.dataLabels"
                    [legend]="expiredAssetsCounts.legend"
                    [stroke]="expiredAssetsCounts.stroke"
                    [colors]="expiredAssetsCounts.colors"
                    dir="ltr"
                  ></apx-chart>

                  <div class="mt-3">
                    <div
                      class="d-flex justify-content-center align-items-center mb-4"
                    >
                      <h2 class="me-3 ff-secondary mb-0">
                        {{ totalExpiredAssetCounts }}
                      </h2>
                      <div>
                        <p class="text-muted mb-0">Total Expired Assets</p>
                      </div>
                    </div>

                    <div
                      class="d-flex justify-content-between border-bottom border-bottom-dashed py-2 mt-3"
                    >
                      <p class="fw-medium mb-0">
                        <i
                          class="ri-checkbox-blank-circle-fill text-success align-middle me-2"
                        ></i>
                        {{ expiredCounts[0].label }}
                      </p>
                      <div>
                        <span class="text-muted pe-5"
                          >{{ expiredCounts[0].value }} Assets</span
                        >
                      </div>
                    </div>
                    <!-- end -->

                    <div
                      class="d-flex justify-content-between border-bottom border-bottom-dashed py-2"
                    >
                      <p class="fw-medium mb-0">
                        <i
                          class="ri-checkbox-blank-circle-fill text-primary align-middle me-2"
                        ></i>
                        {{ expiredCounts[1].label }}
                      </p>
                      <div>
                        <span class="text-muted pe-5"
                          >{{ expiredCounts[1].value }} Assets</span
                        >
                      </div>
                    </div>
                    <!-- end -->
                    <div
                      class="d-flex justify-content-between border-bottom border-bottom-dashed py-2"
                    >
                      <p class="fw-medium mb-0">
                        <i
                          class="ri-checkbox-blank-circle-fill text-warning align-middle me-2"
                        ></i>
                        {{ expiredCounts[2].label }}
                      </p>
                      <div>
                        <span class="text-muted pe-5"
                          >{{ expiredCounts[2].value }} Assets</span
                        >
                      </div>
                    </div>
                    <!-- end -->
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-6 col-md-6 col-lg-6">
              <div class="card card-height-100">
                <div class="card-header">
                  <h4 class="card-title mb-0">Asset Critical Counts</h4>
                </div>

                <div class="card-body">
                  <apx-chart
                    [series]="criticalAssetsRadialGraph?.series"
                    [chart]="criticalAssetsRadialGraph?.chart"
                    [colors]="criticalAssetsRadialGraph?.colors"
                    [dataLabels]="criticalAssetsRadialGraph?.dataLabels"
                    [plotOptions]="criticalAssetsRadialGraph?.plotOptions"
                    [yaxis]="criticalAssetsRadialGraph?.yaxis"
                    [legend]="criticalAssetsRadialGraph?.legend"
                    [fill]="criticalAssetsRadialGraph?.fill"
                    [stroke]="criticalAssetsRadialGraph?.stroke"
                    [tooltip]="criticalAssetsRadialGraph?.tooltip"
                    [xaxis]="criticalAssetsRadialGraph?.xaxis"
                    dir="ltr"
                  ></apx-chart>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="3">
        <a ngbNavLink> Accessible Resource</a>
        <ng-template ngbNavContent>
          <ul
            ngbNav
            #nav="ngbNav"
            [(activeId)]="issueAssetsActive" 
            (activeIdChange)="onTabChangeIssueAssetsActive($event)"
            class="nav nav-tabs nav-tabs-custom nav-success mb-0"
          >
            <li [ngbNavItem]="1">
              <a ngbNavLink>
                <i class="ri-store-2-fill me-1 align-bottom"></i> Without
                Delivery Date
              </a>
              <ng-template ngbNavContent>
                <app-asset-delivered-installed [selectedCompanyId]="selectedCompanyId"
                  [SearchIsDeliveredAndInstalled]="'Not Delivered'"
                ></app-asset-delivered-installed>
              </ng-template>
            </li>
            <li [ngbNavItem]="2">
              <a ngbNavLink> 
                <i class="ri-checkbox-circle-line me-1 align-bottom"></i>
                Without Installation Date
              </a>
              <ng-template ngbNavContent>
                <app-asset-delivered-installed  [selectedCompanyId]="selectedCompanyId"
                  [SearchIsDeliveredAndInstalled]="'Not Installed'"
                ></app-asset-delivered-installed>
              </ng-template>
            </li>
            <li [ngbNavItem]="3">
              <a ngbNavLink>
                <i class="ri-close-circle-line me-1 align-bottom"></i>
                Fundamental Asset
              </a>
              <ng-template ngbNavContent>
              <app-asset-critical  [selectedCompanyId]="selectedCompanyId"></app-asset-critical>
              </ng-template>
            </li>  
            
            <li [ngbNavItem]="4">
              <a ngbNavLink>
                <i class=" ri-award-line me-1 align-bottom"></i>
                Warranty Asset
              </a>
              <ng-template ngbNavContent>
              <app-asset-warranty-list  [selectedCompanyId]="selectedCompanyId"></app-asset-warranty-list>
              </ng-template>
            </li> 
            <li [ngbNavItem]="5">
              <a ngbNavLink>
                <i class="ri-alarm-warning-line me-1 align-bottom"></i>
                Extended Asset
              </a>
              <ng-template ngbNavContent>
              <app-asset-extended-list  [selectedCompanyId]="selectedCompanyId"></app-asset-extended-list>
              </ng-template>
            </li> <li [ngbNavItem]="6">
              <a ngbNavLink>
                <i class=" ri-group-2-line me-1 align-bottom"></i>
                RMA Asset
              </a>
              <ng-template ngbNavContent>
              <app-asset-rma-list  [selectedCompanyId]="selectedCompanyId"></app-asset-rma-list>
              </ng-template>
            </li>

           
          </ul>

          <!-- Tab panes -->
          <div class="tab-content text-muted">
            <div [ngbNavOutlet]="nav"></div>
          </div>
        </ng-template>
      </li>
    </ul>
    <div class="tab-content text-muted mt-3">
      <div [ngbNavOutlet]="nav"></div>
    </div>
  </div>
</div>
