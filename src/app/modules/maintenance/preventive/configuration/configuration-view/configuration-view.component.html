<!-- Start Breadcrumbs -->
<app-breadcrumbs
  title="Preventive Management"
  [breadcrumbItems]="breadCrumbItems"
></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row mt-1">
  <div class="col-lg-12">
    <div class="card mt-n4 mx-n4">
      <div class="bg-warning-subtle">
        <div class="card-body pb-0 px-4">
          <div class="row mb-4">
            <a
              href="javascript:void(0);"
              class="text-primary text-decoration-underline fw-medium text-end"
              (click)="refreshThePage()"
            >
              <i class="ri-refresh-line text-primary fs-18"></i
            ></a>
            <div class="col-md">
              <div class="row align-items-center">
                <div class="col-md">
                  <div>
                    <h4 class="fw-bold">
                      {{
                        masterScheduleList?.configPreventivePDescription || "-"
                      }}
                    </h4>
                    <div class="hstack gap-3 flex-wrap">
                      <div>
                        <i class="ri-building-line align-bottom me-1"></i>
                        {{ masterScheduleList?.companyName || "-" }}
                      </div>
                      <div class="vr"></div>
                      <div>
                        <i class="ri-building-2-line align-bottom me-1"></i
                        >{{ masterScheduleList?.clientName || "-" }}
                      </div>

                      <div class="vr"></div>
                      <div>
                        <i class="ri-community-line align-bottom me-1"></i
                        >{{ masterScheduleList?.projectName || "-" }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ul
            ngbNav
            #customNav="ngbNav"
            [(activeId)]="activeId"
            class="nav nav-tabs-custom border-bottom-0"
            role="tablist"
          >
            <!-- View Ticket  -->
            <li [ngbNavItem]="1" class="nav-item">
              <a ngbNavLink class="nav-link" data-bs-toggle="tab" role="tab">
                Schedule
              </a>
              <ng-template ngbNavContent>
                <div class="row">
                  <div class="col-xxl-8">
                    <div class="row me-0 ms-0">
                      <div class="col-lg-12">
                        <div class="card">
                          <div class="card-body">
                            <h6 class="fw-semibold text-uppercase mb-3">
                              Remark
                            </h6>
                            <p class="text-muted mb-2">
                              {{ masterScheduleList.remark || "-" }}
                            </p>

                            <h5 class="card-title mb-4">CheckList Type</h5>
                            <div
                              class="d-flex flex-wrap gap-2 fs-20 smalltext1"
                            >
                              <a
                                href="javascript:void(0);"
                                class="badge bg-primary-subtle text-primary smalltext"
                                *ngFor="let skill of masterCheckListList"
                                >{{ skill.preventiveTypeName }}</a
                              >
                            </div>
                          </div>
                        </div>
                        <div class="card mt-3">
                          <div
                            class="card-header d-flex justify-content-between align-items-center"
                          >
                            <h6 class="card-title mb-0">Skip Months</h6>

                            <button
                            

                            class="btn btn-primary"
                              (click)="addSkipMonth(addSkipMonthForm)"
                            >
                              Add Skip Month
                            </button>
                          </div>
                          <div class="card-body maxHeightCard">
                            <div class="table-responsive table-card mb-0">
                              <table class="table">
                                <thead>
                                  <tr
                                    class="bg-light text-muted text-uppercase"
                                  >
                                    <th>Month</th>

                                    <th></th>
                                  </tr>
                                </thead>
                                <tbody
                                  *ngIf="
                                    maintenanceScheduleSkipList.length != 0
                                  "
                                >
                                  <tr
                                    *ngFor="
                                      let item of maintenanceScheduleSkipList
                                    "
                                  >
                                    <td>
                                      <a
                                        href="javascript:void(0)"
                                        class="fw-medium link-primary"
                                        >{{ item.skipFlag || "NA" }}</a
                                      >
                                    </td>

                                    <td class="text-end">
                                      <i
                                        (click)="
                                          openModalDeleteSkipMonth(
                                            item.scheduleSkipId
                                          )
                                        "
                                        class="ri-delete-bin-fill align-bottom me-2 text-danger"
                                      ></i>
                                    </td>
                                  </tr>
                                </tbody>
                                <tbody
                                  *ngIf="
                                    maintenanceScheduleSkipList.length == 0
                                  "
                                >
                                  <tr>
                                    <td colspan="3" class="text-center">
                                      No Skip Months Selected
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xxl-4">
                    <div class="card ribbon-box right">
                      <div
                        class="card-header d-flex justify-content-between align-items-baseline"
                      >
                        <h5 class="card-title mb-0">Schedule Details</h5>
                      </div>
                      <div class="card-body">
                        <div class="table-responsive">
                          <table class="table table-borderless mb-0">
                            <tbody>
                              <tr>
                                <td class="fw-medium w-10">Maintenace Type</td>
                                <td>
                                  {{
                                    masterScheduleList?.maintenanceType || "-"
                                  }}
                                </td>
                              </tr>
                              <tr>
                                <td class="fw-medium w-10">Support Type</td>
                                <td id="t-client">
                                  {{ masterScheduleList?.supportType || "-" }}
                                </td>
                              </tr>

                              <tr>
                                <td class="fw-medium w-10">Frequency</td>
                                <td>
                                  {{ masterScheduleList?.frequency || "-" }}
                                </td>
                              </tr>
                              <tr>
                                <td class="fw-medium w-10">Frequency Data</td>
                                <td>
                                  {{ masterScheduleList?.frequencyData || "-" }}
                                </td>
                              </tr>

                              <tr>
                                <td class="fw-medium w-10">
                                  Next Schdule Start
                                </td>
                                <td>
                                  {{
                                    masterScheduleList?.nextSchduleStart || "-"
                                  }}
                                </td>
                              </tr>

                              <tr>
                                <td class="fw-medium w-10">Status</td>
                                <td>
                                  <span
                                    class="fs-12"
                                    [class]="
                                      returnStatusBadgeClassesStatus(
                                        masterScheduleList.pmScheduleStatusId
                                      )
                                    "
                                    >{{
                                      masterScheduleList.pmScheduleStatusName
                                    }}</span
                                  >
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <!--end card-body-->
                    </div>
                  </div>
                </div>
                <!-- end row -->
              </ng-template>
            </li>
            <!-- /View Ticket  -->
            <!-- View Asset  -->
            <li [ngbNavItem]="2" class="nav-item">
              <a ngbNavLink class="nav-link" data-bs-toggle="tab" role="tab">
                Assets
              </a>
              <ng-template ngbNavContent>
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-12">
                        <app-asset-view
                          [assetList]="assetTicketItem" 
                        ></app-asset-view>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>
            <!--End View Asset  -->
            <li [ngbNavItem]="3" class="nav-item">
              <a ngbNavLink class="nav-link" data-bs-toggle="tab" role="tab">
                Assigned To
              </a>
              <ng-template ngbNavContent>
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-12">
                        <div
                          class="d-flex align-items-center justify-content-between mb-3 mt-2"
                        >
                          <div></div>
                          <div class="mb-2">
                            <button
                              *ngIf="deleteButtonAddButtonShown"
                              class="btn btn-success btn-sm"
                              type="button"
                              class="btn btn-soft-primary btn-sm"
                              data-bs-toggle="modal"
                              data-bs-target="#inviteMembersModal"
                              (click)="openModalTechnician(TechnicianListModal)"
                            >
                              <i class="ri-add-fill align-bottom me-1"></i> Add
                              Member
                            </button>
                          </div>
                        </div>

                        <div class="table-responsive table-card">
                          <table class="table align-middle mb-0">
                            <thead class="table-light text-muted">
                              <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Designation</th>
                                <th scope="col">Phone Number</th>
                                <th
                                  scope="col"
                                  *ngIf="deleteButtonAddButtonShown"
                                >
                                  Action
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <ng-container
                                *ngIf="mX_WOTechAssignment.length == 0"
                              >
                                <tr>
                                  <td colspan="4" class="text-center">
                                    No Member Assign
                                  </td>
                                </tr>
                              </ng-container>
                              <ng-container
                                *ngIf="mX_WOTechAssignment.length != 0"
                              >
                                <tr
                                  *ngFor="let workTech of mX_WOTechAssignment"
                                >
                                  <th scope="row">
                                    <div
                                      class="d-flex align-items-center"
                                      *ngIf="workTech.profileImageUrl"
                                    >
                                      <div class="flex-grow-0">
                                        <div class="d-flex align-items-center">
                                          <div
                                            class="flex-shrink-0 chat-user-img user-own-img align-self-center me-3 ms-0 online"
                                          >
                                            <img
                                              [src]="
                                                imgURl +
                                                workTech.profileImageUrl
                                              "
                                              class="round`ed-circle avatar-xs"
                                              alt=""
                                            />
                                            <!-- <span class="user-status"></span> -->
                                            <div class="dropdown" ngbDropdown>
                                              <span
                                                class="user-status shadow-none arrow-none cursor-pointer"
                                                data-bs-toggle="dropdown"
                                                aria-expanded="false"
                                                ngbDropdownToggle
                                                [class]="
                                                  returnCurrentStatusClassesStatusCircle(
                                                    workTech.currentStatus
                                                  )
                                                "
                                                title="{{
                                                  workTech.currentStatus
                                                }}"
                                              ></span>
                                              <div
                                                *ngIf="workTech.currentStatus"
                                                class="dropdown-menu dropdown-menu-start drop-con p-0"
                                                ngbDropdownMenu
                                              >
                                                <div
                                                  [class]="
                                                    returnCurrentStatusClassesStatus(
                                                      workTech.currentStatus
                                                    )
                                                  "
                                                  class="text-uppercase p-2"
                                                >
                                                  <b class="fs-14">
                                                    {{
                                                      workTech.currentStatus
                                                    }}</b
                                                  >
                                                </div>
                                                <div
                                                  class="white-space-normal text-muted fs-13 p-2"
                                                  *ngIf="
                                                    workTech.currentStatusRemark
                                                  "
                                                >
                                                  {{
                                                    workTech.currentStatusRemark
                                                  }}
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                          <div
                                            class="flex-grow-1 overflow-hidden"
                                          >
                                            <h5
                                              class="text-truncate mb-0 fs-14"
                                            >
                                              <a
                                                class="text-primary username"
                                                data-bs-toggle="offcanvas"
                                                href="javascript:void(0);"
                                                [ngbTooltip]="workTech.fullName?workTech.fullName:workTech.techName "
                                                aria-controls="userProfileCanvasExample"
                                              >
                                                {{ workTech.fullName?workTech.fullName:workTech.techName }}</a
                                              >
                                            </h5>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div
                                      class="d-flex align-items-center"
                                      *ngIf="!workTech.profileImageUrl"
                                    >
                                      <div class="flex-grow-0">
                                        <div class="d-flex align-items-center">
                                          <div
                                            class="flex-shrink-0 chat-user-img-without user-own-img align-self-center me-3 ms-0 online rounded-circle avatar-title-custom"
                                            [class]="
                                              returnCurrentStatusClassesStatus(
                                                workTech.currentStatus
                                              )
                                            "
                                          >
                                            {{ workTech.fullName?.charAt(0)
                                            }}{{ workTech.fullName?.charAt(1) }}

                                            <!-- <span class="user-status"></span> -->
                                            <div class="dropdown" ngbDropdown>
                                              <span
                                                class="user-status shadow-none arrow-none cursor-pointer"
                                                data-bs-toggle="dropdown"
                                                aria-expanded="false"
                                                ngbDropdownToggle
                                                [class]="
                                                  returnCurrentStatusClassesStatusCircle(
                                                    workTech.currentStatus
                                                  )
                                                "
                                                title="{{
                                                  workTech.currentStatus
                                                }}"
                                              ></span>
                                              <div
                                                *ngIf="workTech.currentStatus"
                                                class="dropdown-menu dropdown-menu-start drop-con p-0"
                                                ngbDropdownMenu
                                              >
                                                <div
                                                  [class]="
                                                    returnCurrentStatusClassesStatus(
                                                      workTech.currentStatus
                                                    )
                                                  "
                                                  class="text-uppercase p-2"
                                                >
                                                  <b class="fs-14">
                                                    {{
                                                      workTech.currentStatus
                                                    }}</b
                                                  >
                                                </div>
                                                <div
                                                  class="white-space-normal text-muted fs-13 p-2"
                                                  *ngIf="
                                                    workTech.currentStatusRemark
                                                  "
                                                >
                                                  {{
                                                    workTech.currentStatusRemark
                                                  }}
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                          <div
                                            class="flex-grow-1 overflow-hidden"
                                          >
                                            <h5
                                              class="text-truncate mb-0 fs-14"
                                            >
                                              <a
                                                class="text-primary username"
                                                data-bs-toggle="offcanvas"
                                                href="javascript:void(0);"
                                                aria-controls="userProfileCanvasExample"
                                              >
                                                {{ workTech.fullName }}</a
                                              >
                                            </h5>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </th>
                                  <td>{{ workTech.designationName }}</td>
                                  <td>{{ workTech.phoneNumber }}</td>
                                  <td *ngIf="deleteButtonAddButtonShown">
                                    <a
                                      href="javascript:void(0)"
                                      class="dropdown-item cursor-pointer"
                                      (click)="openModalDeleteConf(workTech)"
                                      ><i
                                        class="ri-delete-bin-fill align-bottom me-2 text-danger"
                                      ></i>
                                    </a>
                                  </td>
                                </tr>
                              </ng-container>
                            </tbody>
                          </table>
                          <!--end table-->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>
            <!-- CheckList  -->
            <li [ngbNavItem]="4" class="nav-item">
              <a ngbNavLink class="nav-link" data-bs-toggle="tab" role="tab">
                CheckList
              </a>
              <ng-template ngbNavContent>
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-12">
                        <app-checklist
                          *ngIf="activeId == 4"
                          [configPreventiveId]="storeConfigPreventiveId"
[masterScheduleList]="masterScheduleList"
                        ></app-checklist>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>

            <!--End  CheckList  -->
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <div class="tab-content text-muted">
      <div [ngbNavOutlet]="customNav"></div>
    </div>
  </div>
</div>

<div class="text-end mb-3">
  <button
    class="btn btn-soft-primary waves-effect mx-3"
    type="button"
    (click)="goback()"
  >
    Back
  </button>
</div>

<ng-template #TechnicianListModal role="document" let-modal>
  <div class="modal-header p-3 bg-primary-subtle">
    <h5 class="modal-title" id="inviteMembersModalLabel">Add Members</h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click'); resetValue()"
    ></button>
  </div>
  <div class="modal-body p-4">
    <div class="search-box mb-3">
      <input
        type="text"
        class="form-control bg-light border-light"
        (keyup)="filterTechnician($event)"
        [(ngModel)]="technicianSearchText"
        placeholder="Search member here..."
      />
      <i class="ri-search-line search-icon"></i>
    </div>
    <ngx-simplebar class="mx-n4 px-4" style="height: 400px">
      <div class="vstack gap-3">
        <div *ngFor="let tech of filteredTechnicianList; let i = index">
          <div
            class="d-flex align-items-center"
            (click)="selectTechnician(filteredTechnicianList, i, tech)"
          >
            <div class="flex-shrink-0 me-3">
              <div class="d-flex align-items-center gap-1">
                <div class="form-check form-check-flat form-check-primary">
                  <label class="form-check-label">
                    <input
                      type="checkbox"
                      value="{{ tech }}"
                      [(ngModel)]="filteredTechnicianList[i].checked"
                      [disabled]="filteredTechnicianList[i].disabled"
                      class="form-check-input"
                    />
                    <i class="input-frame"></i>
                  </label>
                </div>
              </div>
            </div>

            <div class="avatar-xs flex-shrink-0 me-3">
              <!-- <img
                src="{{
                  tech.profileImageUrl
                    ? imgURl + tech.profileImageUrl
                    : '../../../../../assets/images/placeholderimage.png'
                }}"
                style="width: 40px; height: 40px"
                alt=""
                class="img-fluid rounded-circle"
              /> -->

              <div class="d-flex align-items-center">
                <div
              class="flex-shrink-0 chat-user-img user-own-img align-self-center me-3 ms-0 online"
            >
              <img
              src="{{
                tech.profileImageUrl
                  ? imgURl + tech.profileImageUrl
                  : '../../../../../assets/images/placeholderimage.png'
              }}"
                class="rounded-circle avatar-xs"
                alt=""
              />
              <!-- <span class="user-status"></span> -->
              <div class="dropdown" ngbDropdown>
                <span
                  class="user-status shadow-none arrow-none cursor-pointer"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  ngbDropdownToggle
                  [class]="
                    returnCurrentStatusClassesStatusCircle(
                      tech.currentStatus
                    )
                  "
                  title="{{
                    tech.currentStatus
                  }}"
                ></span>
                <div
                  *ngIf="tech.currentStatus"
                  class="dropdown-menu dropdown-menu-start drop-con p-0"
                  ngbDropdownMenu
                >
                  <div
                    [class]="
                      returnCurrentStatusClassesStatus(
                        tech.currentStatus
                      )
                    "
                    class="text-uppercase p-2"
                  >
                    <b class="fs-14">
                      {{
                        tech.currentStatus
                      }}</b
                    >
                  </div>
                  <div
                    class="white-space-normal text-muted fs-13 p-2"
                    *ngIf="
                    tech.currentStatusRemark
                    "
                  >
                    {{
                      tech.currentStatusRemark
                    }}
                  </div>
                </div>
              </div>
                </div>
              </div>



            </div>
            <div class="flex-grow-1">
              <h5 class="fs-14 mb-0">
                <a href="javascript:void(0);" class="text-body d-block">
                  {{ tech.fullName }}
                </a>
                <p class="mt-0 mb-0">{{ tech.designation }}</p>
              </h5>
            </div>
            <div class="flex-shrink-0 me-3 mb-0">
              <p class="mb-0">
                <span
                  ><i class="ri-phone-fill me-1"></i
                  >{{ tech.phoneNumber }}</span
                >
              </p>
              <!-- <p class="mb-0"><span><i class=" ri-mail-check-fill me-1"></i>{{ tech.email }}</span></p> -->
            </div>
          </div>
        </div>
        <div
          class="text-center mt-3 text-muted"
          *ngIf="
            technicianList &&
            filteredTechnicianList &&
            technicianSearchText.length > 0
              ? !filteredTechnicianList.length
              : !technicianList.length
          "
        >
          <p>No Member Found</p>
        </div>
      </div>
    </ngx-simplebar>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      data-bs-dismiss="modal"
      (click)="modal.close('Close click'); resetValue()"
    >
      Close
    </button>

    <button
      class="btn btn-success w-xs me-3"
      type="submit"
      (click)="sweetAlertUpdateTechinionDetails()"
      [disabled]="selectedTech.length == 0"
    >
      Submit
    </button>
  </div>
</ng-template>

<ng-template #addSkipMonthForm let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Add Skip Month</h5>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="modal"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <div class="modal-body">
      <div class="mb-3">
        <div class="form-group">
          <label class="form-label"
            >Month<span class="starRequried">*</span></label
          >
          <ng-select
            [items]="arrayOfMonth"
            bindLabel="name"
            bindValue="id"
            placeholder="Select Month"
            [clearable]="false"
            [(ngModel)]="selectMonthValue"
            [ngModelOptions]="{ standalone: true }"
            [clearable]="false"
          >
          </ng-select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        class="btn w-sm btn-danger fw-medium text-decoration-none"
        data-bs-dismiss="modal"
        (click)="modal.close('Close click')"
        id="deleteRecord-close"
      >
        <i class="ri-close-line me-1 align-middle"></i> Close
      </button>
      <button
        [disabled]="!selectMonthValue"
        type="button"
        class="btn w-sm btn-primary"
        id="delete-product"
        (click)="modal.close('Ok', $event)"
      >
        Yes, Submit It!
      </button>
    </div>
  </div>
</ng-template>
