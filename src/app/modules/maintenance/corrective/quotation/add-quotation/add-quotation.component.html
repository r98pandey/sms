<div class="row justify-content-center">
  <div class="col-xxl-10">
    <div class="card">
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="p-4">
            <div class="text-center mb-2">
              <img
                [src]="
                  companyDetailsObject.companyLogoURL
                    ? imgUrl + companyDetailsObject.companyLogoURL
                    : '../../../../../../assets/images/placeholderimage.png'
                "
                class="card-logo"
                alt="logo light"
                height="47"
              />
            </div>
            <div class="mt-sm-0 mt-0">
              <h6 class="text-muted text-uppercase fw-semibold mb-0">
                {{ companyDetailsObject.companyName }}
              </h6>
              <p class="text-muted mb-1">
                {{ companyDetailsObject.address1 }}
              </p>
              <p class="text-muted mb-1">
                {{
                  companyDetailsObject.address2
                    ? companyDetailsObject.address2
                    : ""
                }}
                {{
                  companyDetailsObject.address3
                    ? companyDetailsObject.address3
                    : ""
                }}
                {{
                  companyDetailsObject.country
                    ? companyDetailsObject.country
                    : ""
                }}
              </p>
              <p class="text-muted mb-0" id="zip-code">
                <span>Zip-code:</span> {{ companyDetailsObject.postalCode }}
              </p>
            </div>
          </div>
          <!--end card-header-->
        </div>
        <div class="col-lg-12">
          <div class="card-header border-bottom-dashed border-top-dashed p-4">
            <div class="d-flex flex-wrap">
              <div class="flex-grow-1">
                <h6 class="text-muted text-uppercase fw-semibold">
                  {{ clientDetailsObject.clientName }}
                </h6>
                <p class="text-muted mb-1" id="address-details">
                  {{ clientDetailsObject.address1 }}
                </p>
                <p class="text-muted mb-1">
                  {{
                    clientDetailsObject.address2
                      ? clientDetailsObject.address2
                      : ""
                  }}
                  {{
                    clientDetailsObject.address3
                      ? clientDetailsObject.address3
                      : ""
                  }}
                  {{
                    clientDetailsObject.country
                      ? clientDetailsObject.country
                      : ""
                  }}
                </p>
                <p class="text-muted mb-0" id="zip-code">
                  <span>Zip-code:</span> {{ clientDetailsObject.postalCode }}
                </p>
              </div>
              <div class="flex-shrink-0 mt-sm-0 mt-3">
                <table>
                  <tbody>
                    <tr>
                      <td class="department-text">
                        <h6>
                          <span class="text-muted fw-normal">{{
                            isProject ? "Project" : "Department"
                          }}</span>
                        </h6>
                      </td>
                      <td>
                        <h6>
                          <span id="legal-register-no"  class="department-text">
                            &nbsp;: &nbsp;{{ ticketInfo.projectName }}</span
                          >
                        </h6>
                      </td>
                    </tr>
                    <tr>
                      <td style="width: 30px">
                        <h6>
                          <span class="text-muted fw-normal">TicketNo</span>
                        </h6>
                      </td>
                      <td>
                        <h6>
                          <span id="legal-register-no"
                            >&nbsp;: &nbsp; {{ ticketInfo.ticketNo }}</span
                          >
                        </h6>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="mt-1 p-2 ps-2">
            <label
              class="form-label text-muted text-uppercase fw-semibold ps-2"
            >
              Thank you for your inquiry. We are pleased to submit our quote as
              follows:
            </label>
          </div>
          <!--end card-header-->
        </div>
        <!--end col-->
        <!--end col-->
      </div>

      <form [formGroup]="InvoicesForm">
        <div class="card-body border-bottom border-bottom-dashed p-4">
          <div class="row">
            <div class="col-lg-5">
              <label for="quotTitle"
                >Quotation Title
                <span class="starRequried">*</span>
              </label>
              <div class="mb-2">
                <textarea
                  class="form-control bg-light border-0"
                  id="quotTitle"
                  rows="2"
                  placeholder="Quotation Title"
                  formControlName="quotTitle"
                  [ngClass]="{
                    'is-invalid': submitted && form['quotTitle'].errors
                  }"
                  [maxlength]="maxCharsDecisionTitle"
                ></textarea>
                <label class="nopadding clrlbl">
                  Characters Remaining:
                  {{ quotTitle?.value?.length }}/{{
                    maxCharsDecisionTitle
                  }}</label
                >

                <div class="invalid-feedback">
                  Please Enter Quotation Title Value
                </div>
              </div>
            </div>
            <div class="col-lg-2"></div>
            <div class="col-lg-5">
              <label for="attenTo"
                >Atten To<span class="starRequried">*</span></label
              >
              <div class="mb-2">
                <textarea
                  class="form-control bg-light border-0"
                  id="attenTo"
                  rows="2"
                  placeholder="Atten To"
                  formControlName="attenTo"
                  [ngClass]="{
                    'is-invalid': submitted && form['attenTo'].errors
                  }"
                  [maxlength]="maxCharsAttenToTitle"
                  ></textarea>
                  <label class="nopadding clrlbl">
                    Characters Remaining:
                    {{ attenTo?.value?.length }}/{{
                      maxCharsAttenToTitle
                    }}</label
                  >
  
                <div class="invalid-feedback">Please Enter Atten To Value</div>
              </div>
            </div>
          </div>
          <!--end row-->
        </div>
        <div class="card-body p-4">
          <div class="row g-3">
            <div class="col-lg-3 col-sm-6">
              <label for="invoicenoInput">Quotation No</label>
              <h5 class="fs-14 mb-0">
                #QUO-YYMM-0000
                <i
                  class="ri-information-line align-middle text-info"
                  ngbTooltip="It will be generated automatically by the system"
                ></i>
              </h5>
            </div>
            <!--end col-->
            <div class="col-lg-3 col-sm-6">
              <label for="date-field">Date</label>
              <h5 class="fs-14 mb-0">
                <span id="invoice-date">{{ todayDate | date }}</span>
              </h5>
            </div>
            <!--end col-->
            <div class="col-lg-3 col-sm-6">
              <label for="discount">Discount</label>
              <input
                type="number"
                [min]="0"
                [max]="100"
                class="form-control bg-light border-0"
                id="discount"
                placeholder="0.00"
                [(ngModel)]="discountRate"
                formControlName="discount"
                (keyup)="calculateDiscount()"
              />

              <div
                *ngIf="
                  discountControl?.invalid &&
                  (discountControl?.dirty || discountControl?.touched)
                "
              >
                <div *ngIf="discountControl?.hasError('min')">
                  The value must be greater than or equal to 0.
                </div>
                <div *ngIf="discountControl?.hasError('max')">
                  The value must be less than or equal to 100.
                </div>
              </div>
            </div>
            <!--end col-->
            <div class="col-lg-3 col-sm-6">
              <div>
                <label for="totalamountInput">Total Amount <span class="fs-10">({{departmentDetail?.currencyCode}})</span></label>
                <input
                  type="text"
                  class="form-control bg-light border-0"
                  id="totalamountInput"
                  formControlName="totalPrice"
                  placeholder="$0.00"
                  readonly
                />
              </div>
            </div>
            <!--end col-->
          </div>
          <!--end row-->
        </div>

        <div class="card-body p-4">
          <div class="table-responsive">
            <table
              class="invoice-table table table-borderless table-nowrap mb-0"
            >
              <thead class="align-middle">
                <tr class="table-active">
                  <th scope="col" style="width: 50px">#</th>
                  <th scope="col">Item Details</th>
                  <th scope="col" style="width: 120px">UOM</th>
                  <th scope="col" style="width: 120px">Unit Price</th>
                  <th scope="col" style="width: 120px">Quantity</th>
                  <th scope="col" class="text-end" style="width: 150px">
                    Amount <span class="fs-10">({{departmentDetail?.currencyCode}})</span>
                  </th>
                  <th scope="col" class="text-end" style="width: 105px"></th>
                </tr>
              </thead>
              <tbody id="newlink" formArrayName="items">
                <tr
                  id="1"
                  class="product"
                  *ngFor="let phone of items?.controls; let i = index"
                  [formGroupName]="i"
                >
                  <th scope="row" class="product-id">{{ i + 1 }}</th>
                  <td class="text-start">
                    <div class="mb-2 text-desc">
                      <input
                        type="text"
                        class="form-control bg-light border-0"
                        id="productName"
                        placeholder="Item Name"
                        formControlName="itemName"
                        [maxlength]="maxCharItemtitle"
                      />
                      <label class="nopadding clrlbl">
                        Characters Remaining:
                        {{ items.at(i).get('itemName').value.length }}/{{ maxCharItemtitle }}
                      </label>
                    </div>
                    <textarea
                      class="form-control bg-light border-0"
                      [id]="'productDetails' + i"
                      rows="2"
                      placeholder="Item Details"
                      [maxlength]="maxCharItemDesp"
                      formControlName="itemDetails"
                    ></textarea>
                    <label class="nopadding clrlbl">
                      Characters Remaining:
                      {{ items.at(i).get('itemDetails').value.length }}/{{ maxCharItemDesp }}
                    </label>
                  </td>
                  <td>
                    <ng-select
                      [items]="unoAraay"
                      placeholder="UOM"
                      formControlName="unoSeleted"
                      [clearable]="false"
                      class="tableClass bg-light border-0"
                    ></ng-select>
                  </td>
                  <td>
                    <input
                      type="number"
                      class="form-control bg-light border-0"
                      placeholder="Unit Price"
                      (keyup)="updateQuantity(i)"
                      formControlName="rate"
                      value="0"
                    />
                    <div class="invalid-feedback">Please enter a rate</div>
                  </td>
                  <td>
                    <div class="input-step">
                      <button type="button" class="minus" (click)="decrement(i)">–</button>
                      <input
                        type="number"
                        class="product-quantity"
                        value="{{ counter[i] }}"
                        formControlName="counterValue"
                        readonly
                      />
                      <button type="button" class="plus" (click)="increment(i)">+</button>
                    </div>
                  </td>
                  <td class="text-end">
                    <div>
                      <input
                        type="text"
                        class="form-control bg-light border-0"
                        formControlName="amount"
                        placeholder="0.00"
                        readonly
                      />
                    </div>
                  </td>
                  <td class="text-end">
                    <i
                      class="ri-delete-bin-6-line text-danger fs-15"
                      (click)="removeItem(i)"
                    ></i>
                  </td>
                </tr>
              </tbody>
              
              <tbody>
                <tr id="newForm" style="display: none">
                  <td class="d-none" colspan="5">
                    <p>Add New Form</p>
                  </td>
                </tr>
                <tr>
                  <td colspan="5">
                    <a
                      href="javascript:void(0);"
                      class="btn btn-soft-secondary fw-medium me-3"
                      id="add-item"
                      (click)="addItem(InvoicesForm.get('items').value.length)"
                      ><i class="ri-add-fill me-1 align-bottom"></i> Add Item</a
                    >
                    <!-- <a
                      href="javascript:void(0);"
                      class="btn btn-soft-secondary fw-medium"
                      id="add-item"
                      (click)="openAssetModal(AssetList)"
                      ><i class="ri-add-fill me-1 align-bottom"></i> Add
                      Asset</a
                    > -->
                  </td>
                </tr>
                <tr class="border-top border-top-dashed mt-2">
                  <td colspan="4"></td>
                  <td colspan="2" class="p-0">
                    <table
                      class="table table-borderless table-sm table-nowrap align-middle mb-0"
                    >
                      <tbody>
                        <tr>
                          <th scope="row">Sub Total</th>
                          <td style="width: 150px">
                            <input
                              type="text"
                              class="form-control bg-light border-0"
                              formControlName="subTotal"
                              id="cart-subtotal"
                              placeholder="0.00"
                              readonly
                            />
                          </td>
                        </tr>
                        <!-- <tr>
                          <th scope="row">Estimated Tax (12.5%)</th>
                          <td>
                            <input
                              type="text"
                              class="form-control bg-light border-0"
                              formControlName="taxPrice"
                              id="cart-tax"
                              placeholder="RM0.00"
                              readonly
                            />
                          </td>
                        </tr> -->
                        <tr>
                          <th scope="row">Discount ({{ discountRate }} %)</th>
                          <td>
                            <input
                              type="text"
                              class="form-control bg-light border-0"
                              formControlName="discountPrice"
                              id="cart-discount"
                              placeholder="0.00"
                              readonly
                            />
                          </td>
                        </tr>
                        <tr>
                          <th scope="row">
                            {{ this.clientDetailsObject.serviceTaxType }} Price
                            ({{ clientDetailsObject.serviceTaxValue }}%)
                          </th>
                          <td>
                            <input
                              type="text"
                              class="form-control bg-light border-0"
                              id="cart-shipping"
                              placeholder="0.00"
                              formControlName="gSTPrice"
                              readonly
                            />
                          </td>
                        </tr>
                        <tr class="border-top border-top-dashed">
                          <th scope="row">Total Amount <span class="fs-10">({{departmentDetail?.currencyCode}})</span></th>
                          <td>
                            <input
                              type="text"
                              class="form-control bg-light border-0"
                              formControlName="totalPrice"
                              id="cart-total"
                              placeholder="0.00"
                              readonly
                            />
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <!--end table-->
                  </td>
                </tr>
              </tbody>
            </table>
            <!--end table-->
          </div>
          <div class="mt-4">
            <label
              for="exampleFormControlTextarea1"
              class="form-label text-muted text-uppercase fw-semibold"
              >Remark <span class="starRequried">*</span></label
            >
            <textarea
              class="form-control bg-light border-0"
              id="Remark"
              rows="2"
              placeholder="Remark"
              formControlName="remarkControl"
              [ngClass]="{
                'is-invalid': submitted && form['remarkControl'].errors
              }"
              [maxlength]="maxCharsDecision"
            ></textarea>
            <label class="nopadding clrlbl">
              Characters Remaining:
              {{ form["remarkControl"]?.value?.length }}/{{
                maxCharsDecision
              }}</label
            >
            <div class="invalid-feedback">Please enter a Remark</div>
          </div>
          <div
            class="hstack gap-2 justify-content-end d-print-none mt-4 flex-wrap"
          >
           <button class="btn btn-soft-primary ms-2 me-2" (click)="goBack()">
              Back
            </button>
            <button
              type="button"
              class="btn btn-success btn-load"
              (click)="submitQuotation()"
              [disabled]="InvoicesForm.invalid || loadingForSubmitBtn"
            >
              <span class="d-flex align-items-center">
                <span
                  class="spinner-border flex-shrink-0 me-2"
                  role="status"
                  *ngIf="loadingForSubmitBtn"
                >
                  <span class="visually-hidden">Loading...</span>
                </span>
                <span class="flex-grow-1">Submit </span>
              </span>
            </button>

           
          </div>
        </div>
      </form>
    </div>
  </div>
  <!--end col-->
</div>
<!--end row-->

<ng-template #AssetList let-offcanvas>
  <div class="offcanvas-header">
    <h4 class="offcanvas-title">Asset List</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="offcanvas.dismiss('Cross click')"
    ></button>
  </div>
  <div class="offcanvas-body p-0">
    <app-common-asset-list
      (assetListSelected)="getAllselectAsset($event)"
      [selectedDropDownCompanyIdValue]="ticketInfo.companyId"
      [selectedDropDownClientIdValue]="ticketInfo.clientId"
      [selectedDropDownProjectOrDeparmentIdValue]="ticketInfo.projectId"
      [selectedAsset]="selectedAssetList"
    ></app-common-asset-list>
  </div>
  <div class="offcanvas-footer text-end gy-2">
    <button
      type="button"
      data-bs-dismiss="modal"
      class="btn btn-outline-danger"
      (click)="offcanvas.dismiss('cancel')"
    >
      Close
    </button>
  </div>
</ng-template>
